<meta charset='utf-8' />
<link href='../lib/main.css' rel='stylesheet' />
<script src='../lib/main.js'></script>
<script>

  document.addEventListener('DOMContentLoaded', function() {
  
  	let loadData = []; // 변수 선언 [{}, {}, {}]
  	
  	fetch('../FullCalendarServlet') // sevlet 값 요청 = XMLHttpRequest() + 따로 요청 안할 시 get 방식 호출
  		.then(result => result.json())
  		.then(json => {
  			console.log(json); 
  			// 현재 상태가 [{}, {}, {}] 라서 굳이 routine을 돌려서 배열 안에 값을 넣을 필요 x
  			//loadData = json;// startDate -> start, endDate -> end
  			json.forEach(schedule => {
  				let obj = {title: schedule.title, start: schedule.startDate, end: schedule.endDate};
  				loadData.push(obj); // {title:? , start:? , end:?}
  			})
  			
  			var calendarEl = document.getElementById('calendar');
  			 var calendar = new FullCalendar.Calendar(calendarEl, {
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      initialDate: '2022-05-09',
      navLinks: true, // can click day/week names to navigate views
      selectable: true,
      selectMirror: true,
      select: function(arg) {
      console.log(arg.startStr, arg.endStr);

        var title = prompt('Event Title:');
        if (title) {
        // 서블릿 활용 -> DB 저장
        fetch('../FullCalendarServlet', {
        	method : 'post',
        	headers: {'Content-Type' : 'application/x-www-form-urlencoded'},
        	body : `job=insert&title=${title}&start=${arg.startStr}&end=${arg.startStr}` // key : value 형식 
        	
        })
        	.then(result => {
        		 // 화면구현.
         		 calendar.addEvent({
           		 title: title,
           		 start: arg.start,
           		 end: arg.end,
           		 allDay: arg.allDay
         		 })
         		 calendar.unselect()
        	})
        	.catch(error=> {
        		console.log(error);
        		calendar.unselect()
        	});
       
        }// end of if(title)
 
      },
      eventClick: function(arg) {
        if (confirm('Are you sure you want to delete this event?')) {
        // 화면 처리.
          arg.event.remove()
        }
      },
      editable: true,
      dayMaxEvents: true, // allow "more" link when too many events
      events: loadData
    });	
        calendar.render();
  		})
  		.catch(error => console.log(error));	


  });

</script>
<style>

  body {
    margin: 40px 10px;
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
  }

  #calendar {
    max-width: 1100px;
    margin: 0 auto;
  }

</style>
</head>
<body>

  <div id='calendar'></div>

</body>
</html>

