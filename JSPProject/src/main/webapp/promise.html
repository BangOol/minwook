<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>promise.html</title>
</head>
<body>
  <script>
    // ajax => XMLHttpRequest();
    // 중첩된 코드 실행 시 비동기적으로 실행 => 순서를 정하기에 배우 비효율적
    //  setTimeout(function(){
    //    console.log(1);
    //    setTimeout(function(){
    //      console.log(2);
    //      setTimeout(function(){
    //        console.log(3);
    //      },3000)
    //    },2000);
    //  },1000);


    //promise 객체
    let val = 4;
    let prom  = new Promise(function (resolve, reject){
      setTimeout(function(){
        if(val >0){
          resolve('success');
          val -= 2;
      }else
          reject('error')},2000); // 지연시켜주는 함수
       // 실패 시 String 타입 error를 반환하겠다.
       // resolve, reject 모두 함수

       // promise 객체에 대해 자세히 공부해보자.
       // promise : 서버에서 받아온 데이터를 화면에 표시할 때 사용
    });
    

    // promise, fetch : JS
    // servlet : JSP ?
    prom 
      .then(function(result){
        console.log(result); // success
        // resolve 함수의 결과가 result 매개변수에 담기게 된다.
        return new Promise(resolve, reject =>{
          setTimeout(function(){
          if(val >0){
            resolve('success');
            val -= 2;
          }else
            reject('error')},1000);
          });
      })
      .then(function (result){
        console.log(result);
        return new Promise(function(resolve, reject){
          setTimeout(function(){
          if(val >0){
            resolve('success');
            val -= 2;
          }else
            reject('error')},2000);
          });
      })
      .then(function (result){
        console.log(result);
        return new Promise(function(resolve, reject){
          setTimeout(function(){
          if(val >0){
            resolve('success');
            val -= 2;
          }else
            reject('error')},3000);
          });
      })
      .catch(function (reject){
        console.log(reject);
      })
  </script>
</body>
</html>